---
layout: page
permalink: /strutture
title: strutture
---
<style>
    .table th {background-color: #06c; color: white}
</style>

<div class="container py-5">
    {% include datatable/strutture/aggregate/struttura/filter.html %}
    <div class="row py-3"></div>
    <div class="row" style="font-size: 10px">
        <div class="col">
            <table id="struttureTable" class="table table-striped table-bordered">
                <thead>
                    {% include datatable/strutture/aggregate/struttura/columns.html %}
                </thead>
                <tfoot>
                {% include datatable/strutture/aggregate/struttura/columns.html %}
                </tfoot>
            </table>
        </div>
    </div>
</div>

<script>

    let $table;
    const JSON_ENDPOINT = "{{ site.baseurl }}/knime_data/aggregate_strutture0.json";

    $(document).ready(function() {
        $.ajax({
            url: JSON_ENDPOINT,
        }).done(function(csv) {
            // console.log(csv)
            $table = $('#struttureTable').DataTable({
                data: csv,
                responsive: true,
                "columns": [
                    { data: "Anno" },
                    { data: "Codice Regione" },
                    { data: "Descrizione Regione" },
                    { data: "Codice Azienda" },
                    { data: "Denominazione Azienda" },
                    { data: "Codice USL territoriale" },
                    { data: "Codice struttura" },
                    { data: "Denominazione struttura" },
                    { data: "Tipo struttura" },
                    { data: "Descrizione tipo struttura" },
                    { data: "Totale posti degenza" }
                ]
            });
            //
            // addColumnsFiltering($table)
            // $table.column(3).search('Lazio').draw();

            enableFilterHandlers()
        });
    });

    const addColumnsFiltering = function (table) {
        table.columns( '.select-filter' ).every( function () {
            console.log('item',this)
            var that = this;

            // Create the select list and search operation
            var select = $('<select />')
                .appendTo(
                    this.header()
                )
                .on( 'change', function () {
                    that
                        .search( $(this).val() )
                        .draw();
                } );

            // Get the search data for the first column and add to the select list
            this
                .cache( 'search' )
                .sort()
                .unique()
                .each( function ( d ) {
                    select.append( $('<option value="'+d+'">'+d+'</option>') );
                } );
        } );
    }

    const strutturaColumnIndex = 7;
    const comuneColumnIndex= 25;
    const capColumnIndex= 23;

    const enableFilterHandlers = function () {
        // struttura filter
        $strutturaInput = $('#struttura')
        addFilterOnEvent($strutturaInput, strutturaColumnIndex, 'keyup')
        // comune filter
        $comuneInput = $('#comune')
        addFilterOnEvent($comuneInput, comuneColumnIndex, 'keyup')
        // cap
        $capInput = $('#cap')
        addFilterOnEvent($capInput, capColumnIndex, 'keyup')
    }

    const addFilterOnEvent = function ($element, columnIndex, eventName) {
        const $column = $table.columns(columnIndex);
        $element.on( eventName, function () {
            console.log('searching item', $(this).val())
            $column.search( $(this).val() ).draw();
        });
    }

</script>